name: CD

on:
    workflow_dispatch:
    workflow_run:
      workflows: ["Other Workflow Name"]
      types: [completed]

  jobs:
    on-success:
      runs-on: ubuntu-latest
      if: ${{ github.event.workflow_run.conclusion == 'success' }}
      steps:
        - run: echo "First workflow was a success"
        - run: echo "The success was due to ${{ github.event.workflow_run.conclusion }}"
        # As usual, we simply checkout the project
        - name: Checkout
          uses: actions/checkout@v4
        # Install the latest version of node
        - name: Set up Node.js
          uses: actions/setup-node@v4
          with:
            node-version: "20"
        # Install yarn (prefered build tool)
        - name: Install Yarn
          run: npm install -g yarn
        # Install project dependencies
        - name: Install dependencies
          run: yarn install --frozen-lockfile
        # Build and deploy the project
        - name: Build and deploy
          run: yarn run deploy
 
    on-failure:
      runs-on: ubuntu-latest
      if: ${{ github.event.workflow_run.conclusion == 'failure' }}
      steps:
        - run: echo "First workflow was a failure"
        - run: echo "The failure was due to ${{ github.event.workflow_run.conclusion }}"
        - run: exit 1